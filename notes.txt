Input AAAABBBBCCCCDDDD
000000005D9D6A0  44 00 00 00 00 00 00 00  A8 D6 D9 05 00 00 00 00  D............... @5ce64ae
000000005D9D6B0  A8 D6 D9 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
000000005D9D6C0  DA 64 F2 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
000000005D9D6D0  04 00 00 00 00 00 00 00  FF FF 00 00 00 00 00 00  ................

000000005D9D6A0  44 00 00 00 00 00 00 00  A8 D6 D9 05 00 00 00 00  D...............
000000005D9D6B0  A8 D6 D9 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
000000005D9D6C0  DA 64 F2 05 00 00 00 00  01 00 00 00 00 00 00 00  ................
000000005D9D6D0  04 00 00 00 00 00 00 00  01 00 00 00 00 00 00 00  ................

0000000005D9D6A0  44 00 00 00 00 00 00 00  A8 D6 D9 05 00 00 00 00  D...............
0000000005D9D6B0  A8 D6 D9 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6C0  DA 64 F2 05 00 00 00 00  02 00 00 00 00 00 00 00  ................
0000000005D9D6D0  04 00 00 00 00 00 00 00  01 00 00 00 00 00 00 00  ................

0000000005D9D6A0  44 00 00 00 00 00 00 00  A8 D6 D9 05 00 00 00 00  D...............
0000000005D9D6B0  A8 D6 D9 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6C0  DA 64 F2 05 00 00 00 00  03 00 00 00 00 00 00 00  ................
0000000005D9D6D0  04 00 00 00 00 00 00 00  01 00 00 00 00 00 00 00  ................

0000000005D9D6A0  44 00 00 00 00 00 00 00  A8 D6 D9 05 00 00 00 00  D...............
0000000005D9D6B0  A8 D6 D9 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6C0  DA 64 F2 05 00 00 00 00  04 00 00 00 00 00 00 00  ................
0000000005D9D6D0  04 00 00 00 00 00 00 00  01 00 00 00 00 00 00 00  ................

0000000005D9D6A0  44 00 00 00 00 00 00 00  A8 D6 D9 05 00 00 00 00  D............... @5ce64c6
0000000005D9D6B0  A8 D6 D9 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6C0  4C 65 F2 05 00 00 00 00  CB F4 8D 7C 00 00 00 00  Le.........|....		<-different input, different values -> first value is VM RIP
0000000005D9D6D0  49 D1 81 7C 00 00 00 00  CB F4 00 00 00 00 00 00  Iс |............		<-different input, different values 

0000000005D9D6A0  44 00 00 00 00 00 00 00  A8 D6 D9 05 00 00 00 00  D............... @5ce670f
0000000005D9D6B0  A8 D6 D9 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6C0  63 65 F2 05 00 00 00 00  00 00 00 00 00 00 00 00  ce..............
0000000005D9D6D0  00 00 00 00 00 00 00 00  CB F4 00 00 00 00 00 00  ................

0000000005D9D6A0  44 00 00 00 00 00 00 00  A8 D6 D9 05 00 00 00 00  D...............
0000000005D9D6B0  A8 D6 D9 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6C0  F9 65 F2 05 00 00 00 00  00 00 00 00 00 00 00 00  .e..............
0000000005D9D6D0  01 00 00 00 00 00 00 00  CB F4 00 00 00 00 00 00  ................

0000000005D9D6A0  44 00 00 00 00 00 00 00  A8 D6 D9 05 00 00 00 00  D...............
0000000005D9D6B0  A8 D6 D9 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6C0  BE 66 F2 05 00 00 00 00  00 00 00 00 00 00 00 00  .f..............
0000000005D9D6D0  02 00 00 00 00 00 00 00  CB F4 00 00 00 00 00 00  ................

0000000005D9D6A0  44 00 00 00 00 00 00 00  A8 D6 D9 05 00 00 00 00  D............... @5ce64c6
0000000005D9D6B0  A8 D6 D9 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6C0  D2 67 F2 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6D0  04 00 00 00 00 00 00 00  CB F4 00 00 00 00 00 00  ................

Input AAAAAAAAAAAAAAAA

0000000005D9D6A0  44 00 00 00 00 00 00 00  A8 D6 D9 05 00 00 00 00  D............... @5ce64ae
0000000005D9D6B0  A8 D6 D9 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6C0  DA 54 F2 05 00 00 00 00  00 00 00 00 00 00 00 00  ................   <- 0
0000000005D9D6D0  04 00 00 00 00 00 00 00  FF FF 00 00 00 00 00 00  ................

0000000005D9D6A0  44 00 00 00 00 00 00 00  A8 D6 D9 05 00 00 00 00  D...............
0000000005D9D6B0  A8 D6 D9 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6C0  DA 54 F2 05 00 00 00 00  01 00 00 00 00 00 00 00  ................   <- 1
0000000005D9D6D0  04 00 00 00 00 00 00 00  01 00 00 00 00 00 00 00  ................

0000000005D9D6A0  44 00 00 00 00 00 00 00  A8 D6 D9 05 00 00 00 00  D...............
0000000005D9D6B0  A8 D6 D9 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6C0  DA 54 F2 05 00 00 00 00  02 00 00 00 00 00 00 00  ................   <- 2
0000000005D9D6D0  04 00 00 00 00 00 00 00  01 00 00 00 00 00 00 00  ................

0000000005D9D6A0  44 00 00 00 00 00 00 00  A8 D6 D9 05 00 00 00 00  D...............
0000000005D9D6B0  A8 D6 D9 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6C0  DA 54 F2 05 00 00 00 00  03 00 00 00 00 00 00 00  ................   <- 3
0000000005D9D6D0  04 00 00 00 00 00 00 00  01 00 00 00 00 00 00 00  ................

0000000005D9D6A0  44 00 00 00 00 00 00 00  A8 D6 D9 05 00 00 00 00  D...............
0000000005D9D6B0  A8 D6 D9 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6C0  DA 54 F2 05 00 00 00 00  04 00 00 00 00 00 00 00  ................   <- 4
0000000005D9D6D0  04 00 00 00 00 00 00 00  01 00 00 00 00 00 00 00  ................

0000000005D9D6A0  44 00 00 00 00 00 00 00  A8 D6 D9 05 00 00 00 00  D............... @5ce64c6
0000000005D9D6B0  A8 D6 D9 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6C0  4C 55 F2 05 00 00 00 00  CB F4 8D 7C 00 00 00 00  LU.........|....		<-different input, different values
0000000005D9D6D0  49 D1 81 7C 00 00 00 00  CB F4 00 00 00 00 00 00  Iс |............

0000000005D9D6A0  44 00 00 00 00 00 00 00  A8 D6 D9 05 00 00 00 00  D............... @5ce670f
0000000005D9D6B0  A8 D6 D9 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6C0  63 55 F2 05 00 00 00 00  00 00 00 00 00 00 00 00  cU..............
0000000005D9D6D0  00 00 00 00 00 00 00 00  CB F4 00 00 00 00 00 00  ................

0000000005D9D6A0  44 00 00 00 00 00 00 00  A8 D6 D9 05 00 00 00 00  D...............
0000000005D9D6B0  A8 D6 D9 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6C0  F9 55 F2 05 00 00 00 00  00 00 00 00 00 00 00 00  .U..............
0000000005D9D6D0  01 00 00 00 00 00 00 00  CB F4 00 00 00 00 00 00  ................

0000000005D9D6A0  44 00 00 00 00 00 00 00  A8 D6 D9 05 00 00 00 00  D...............
0000000005D9D6B0  A8 D6 D9 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6C0  BE 56 F2 05 00 00 00 00  00 00 00 00 00 00 00 00  .V..............
0000000005D9D6D0  02 00 00 00 00 00 00 00  CB F4 00 00 00 00 00 00  ................

0000000005D9D6A0  44 00 00 00 00 00 00 00  A8 D6 D9 05 00 00 00 00  D............... @5ce64c6
0000000005D9D6B0  A8 D6 D9 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6C0  D2 57 F2 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6D0  04 00 00 00 00 00 00 00  CB F4 00 00 00 00 00 00  ................

Input CAFEBABECAFEBABE

0000000005D9D6A0  44 00 00 00 00 00 00 00  A8 D6 D9 05 00 00 00 00  D...............
0000000005D9D6B0  A8 D6 D9 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6C0  DA E4 E5 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6D0  04 00 00 00 00 00 00 00  FF FF 00 00 00 00 00 00  ................

0000000005D9D6A0  44 00 00 00 00 00 00 00  A8 D6 D9 05 00 00 00 00  D...............
0000000005D9D6B0  A8 D6 D9 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6C0  DA E4 E5 05 00 00 00 00  01 00 00 00 00 00 00 00  ................
0000000005D9D6D0  04 00 00 00 00 00 00 00  01 00 00 00 00 00 00 00  ................

0000000005D9D6A0  44 00 00 00 00 00 00 00  A8 D6 D9 05 00 00 00 00  D...............
0000000005D9D6B0  A8 D6 D9 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6C0  DA E4 E5 05 00 00 00 00  02 00 00 00 00 00 00 00  ................
0000000005D9D6D0  04 00 00 00 00 00 00 00  01 00 00 00 00 00 00 00  ................

0000000005D9D6A0  44 00 00 00 00 00 00 00  A8 D6 D9 05 00 00 00 00  D...............
0000000005D9D6B0  A8 D6 D9 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6C0  DA E4 E5 05 00 00 00 00  03 00 00 00 00 00 00 00  ................
0000000005D9D6D0  04 00 00 00 00 00 00 00  01 00 00 00 00 00 00 00  ................

0000000005D9D6A0  44 00 00 00 00 00 00 00  A8 D6 D9 05 00 00 00 00  D...............
0000000005D9D6B0  A8 D6 D9 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6C0  DA E4 E5 05 00 00 00 00  04 00 00 00 00 00 00 00  ................
0000000005D9D6D0  04 00 00 00 00 00 00 00  01 00 00 00 00 00 00 00  ................

0000000005D9D6A0  44 00 00 00 00 00 00 00  A8 D6 D9 05 00 00 00 00  D............... @5ce64c6
0000000005D9D6B0  A8 D6 D9 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6C0  4C E5 E5 05 00 00 00 00  CB F4 8D 7C 00 00 00 00  L..........|....		<-different input, different values
0000000005D9D6D0  B4 EA 82 7C 00 00 00 00  CB F4 00 00 00 00 00 00  ................

0000000005D9D6A0  44 00 00 00 00 00 00 00  A8 D6 D9 05 00 00 00 00  D............... @5ce670f
0000000005D9D6B0  A8 D6 D9 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6C0  63 E5 E5 05 00 00 00 00  00 00 00 00 00 00 00 00  c...............
0000000005D9D6D0  00 00 00 00 00 00 00 00  CB F4 00 00 00 00 00 00  ................

0000000005D9D6A0  44 00 00 00 00 00 00 00  A8 D6 D9 05 00 00 00 00  D...............
0000000005D9D6B0  A8 D6 D9 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6C0  F9 E5 E5 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6D0  01 00 00 00 00 00 00 00  CB F4 00 00 00 00 00 00  ................

0000000005D9D6A0  44 00 00 00 00 00 00 00  A8 D6 D9 05 00 00 00 00  D...............
0000000005D9D6B0  A8 D6 D9 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6C0  BE E6 E5 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6D0  02 00 00 00 00 00 00 00  CB F4 00 00 00 00 00 00  ................

0000000005D9D6A0  44 00 00 00 00 00 00 00  A8 D6 D9 05 00 00 00 00  D............... @5ce64c6
0000000005D9D6B0  A8 D6 D9 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6C0  D2 E7 E5 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D9D6D0  04 00 00 00 00 00 00 00  CB F4 00 00 00 00 00 00  ................

Approach: Try to bf the resulting bytes

We have: 

Static 
A8 D6 D9 05 @ r9-0x20 (5d9d6b0) -> This is a stack addr -> 05d9d6a8
CB F4 8D 7C @ r9-0x8  (5d9d6c8) @ 5ce64c6

Volatile:

Values at 5d9d6c0 - r9-0x10
Values are 1:1 identical during hit at @5ce64ae
They change once @5ce64c6 is hit
And then 4x on each hit of @5ce670f and @5ce64c6

0000005D78ED0  41 41 00 00 00 00 00 00  41 41 00 00 00 00 00 00  AA......AA......
0000005D78EE0  41 41 00 00 00 00 00 00  41 41 00 00 00 00 00 00  AA......AA......
0000005D78EF0  41 41 00 00 00 00 00 00  41 41 00 00 00 00 00 00  AA......AA......
0000005D78F00  41 41 00 00 00 00 00 00  41 41 00 00 00 00 00 00  AA......AA......
0000005D78F10  41 41 41 41 41 41 41 41  41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA
0000005D78F20  44 61 00 00 00 00 00 00  34 75 00 00 00 00 00 00  Da......4u......
0000005D78F30  62 69 00 00 00 00 00 00  63 6C 00 00 00 00 00 00  bi......cl......

R9=0x0000000005D786D0

0000000005D786A0  44 00 00 00 00 00 00 00  A8 86 D7 05 00 00 00 00  D...............
0000000005D786B0  A8 86 D7 05 00 00 00 00  00 00 00 00 00 00 00 00  ................
0000000005D786C0  38 95 F0 05 00 00 00 00  01 00 00 00 00 00 00 00  8...............



VeqzAAAAAAAAAAAA
VerYAAAAAAAAAAAA
Ves8AAAAAAAAAAAA
VfPzAAAAAAAAAAAA
VfQYAAAAAAAAAAAA
VfR8AAAAAAAAAAAA
Vg0YAAAAAAAAAAAA
Vg18AAAAAAAAAAAA
WDqzAAAAAAAAAAAA
WDrYAAAAAAAAAAAA
WDs8AAAAAAAAAAAA
WEPzAAAAAAAAAAAA
WEQYAAAAAAAAAAAA
WER8AAAAAAAAAAAA
WF0YAAAAAAAAAAAA
WF18AAAAAAAAAAAA
X$PzAAAAAAAAAAAA
X$QYAAAAAAAAAAAA
X$R8AAAAAAAAAAAA


2nd Block
VerYDumBAAAAAAAA

3rd Block
"Educated guess" :-/ 

Also once Adler32 was identified: https://md5hashing.net/hash/adler32/0f910374

Description of approach:

I used the same load Pe sub for challenge 9 and there it worked perfectly for all sections. 
But for the efi it did not. Turned out I only needed .text so it was not that bad. I think 
an EFI PE has other values like alignment etc which is not compatible with unicorn who eg 
expects a pagesize of 4096 bytes etc.

Tried for an hour and then gave up and only mapped .text and created a new data segment myself .

bruter.py is the correct one. the implementation is in newmain() not main.... 
So the thing is as follows. In "main()" I tried the following:

Run to the first check, (here the first block is successully checked, because I give him a valid 
1st block), then I do a single step and then I say, run again until the check RVA. And check now 
if we have a win or restrt with the next input test. Like "run, step, run". The problem was that 
suddenly THIS was dead slow again - the 2nd run after the step and I dont really have an idea why 
this is. 

In newmain() I tried it differently (this one was again blazing fast): I used hook_code again but 
only monitored this very cmp operation in the checker operation, NOTHING else. And I now said not 
"run to the cmp basic block" but "run from start until you exit the VM and resturn". It will there 
trigger twice the hook and when both blocks are correct correct_cnt will be 2, if the 2nd guess it's 
wrong, it will be only 1, and so I can bf. This variant was again very fast.

I have no idea why the "main()" variant is so slow. I presume it might be a bug again


Run qemu like so:

qemu-system-x86_64 -smbios type=0,uefi=on -bios bios.bin -drive file=disk_start.img -s -debugcon file:debug.log -global isa-debugcon.iobase=0x402 -display none -vnc :0
Check debug.log after run for the offset the shell gets loaded to, to rebase IDAs analysis of the EFI binary to for proper debugging.

Ubuntu qemu is too old - it won't work here! You need v9 from kali or windows build!
